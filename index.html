<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Purchase Analysis Dashboard - Seed Stage Founder</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .color-legend {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
            padding: 15px;
            background: rgba(255,255,255,0.7);
            border-radius: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.85em;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .scrape-button {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            margin: 10px;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .scrape-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(255, 107, 107, 0.4);
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 1.2em;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            opacity: 0.9;
            font-size: 0.9em;
        }
        
        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .chart-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            border: 1px solid #f0f0f0;
        }
        
        .chart-title {
            font-size: 1.3em;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        .recommendations {
            background: linear-gradient(135deg, #11998e, #38ef7d);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-top: 30px;
        }
        
        .recommendations h2 {
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        
        .rec-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .rec-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        
        .rec-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .filter-group label {
            font-size: 0.9em;
            color: #666;
            font-weight: 500;
        }
        
        select, input {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 0.9em;
            background: white;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.1em;
        }
        
        @media (max-width: 768px) {
            .charts-container {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .dashboard {
                padding: 20px;
                margin: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>üöó Car Purchase Analysis Dashboard</h1>
            <p>Data-driven car selection for seed stage founder in SF Bay Area</p>
            <button class="scrape-button" onclick="scrapeLatestPrices()">üì° Scrape Live Prices & Ratings</button>
            
            <div class="color-legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #667eea;"></div>
                    <span>EV/Hybrid SUV</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #764ba2;"></div>
                    <span>Luxury Sedan</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f093fb;"></div>
                    <span>Sports Car</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f5576c;"></div>
                    <span>Compact/Budget</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #4facfe;"></div>
                    <span>Luxury SUV</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #00f2fe;"></div>
                    <span>Pickup Truck</span>
                </div>
            </div>
        </div>
        
        <div class="loading" id="loading">
            Loading car data and building charts...
        </div>
        
        <div id="content" style="display: none;">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalCars">0</div>
                    <div class="stat-label">Cars Analyzed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgTCO">$0</div>
                    <div class="stat-label">Avg 3-Year TCO</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="bestValue">-</div>
                    <div class="stat-label">Best Value Pick</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="topCredibility">-</div>
                    <div class="stat-label">Top Credibility</div>
                </div>
            </div>
            
            <div class="filters">
                <div class="filter-group">
                    <label>Budget Range</label>
                    <select id="budgetFilter">
                        <option value="all">All Budgets</option>
                        <option value="under15k">Under $15k</option>
                        <option value="15to25k">$15k - $25k</option>
                        <option value="25to35k">$25k - $35k</option>
                        <option value="35to50k">$35k - $50k</option>
                        <option value="over50k">Over $50k</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Brand</label>
                    <select id="brandFilter">
                        <option value="all">All Brands</option>
                        <option value="Toyota">Toyota</option>
                        <option value="Honda">Honda</option>
                        <option value="BMW">BMW</option>
                        <option value="Tesla">Tesla</option>
                        <option value="Genesis">Genesis</option>
                        <option value="Audi">Audi</option>
                        <option value="Mercedes">Mercedes</option>
                        <option value="Lexus">Lexus</option>
                        <option value="Porsche">Porsche</option>
                        <option value="Ford">Ford</option>
                        <option value="Chevrolet">Chevrolet</option>
                        <option value="Mazda">Mazda</option>
                        <option value="Subaru">Subaru</option>
                        <option value="Hyundai">Hyundai</option>
                        <option value="Kia">Kia</option>
                        <option value="Nissan">Nissan</option>
                        <option value="Acura">Acura</option>
                        <option value="Infiniti">Infiniti</option>
                        <option value="Volvo">Volvo</option>
                        <option value="Cadillac">Cadillac</option>
                        <option value="Lincoln">Lincoln</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Category</label>
                    <select id="categoryFilter">
                        <option value="all">All Categories</option>
                        <option value="Budget">Budget Cars</option>
                        <option value="Luxury">Luxury</option>
                        <option value="Sports">Sports Cars</option>
                        <option value="SUV">SUVs</option>
                        <option value="Sedan">Sedans</option>
                        <option value="EV">Electric</option>
                        <option value="Hybrid">Hybrid</option>
                        <option value="Truck">Trucks</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Fuel Type</label>
                    <select id="fuelFilter">
                        <option value="all">All Types</option>
                        <option value="Electric">Electric</option>
                        <option value="Hybrid">Hybrid</option>
                        <option value="PHEV">PHEV</option>
                        <option value="Gas">Gas</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Min Reliability</label>
                    <input type="range" id="reliabilityFilter" min="5" max="10" value="5" step="1">
                    <span id="reliabilityValue">5</span>
                </div>
            </div>
            
            <div class="charts-container">
                <div class="chart-card">
                    <div class="chart-title">üí∞ TCO by Brand (Average)</div>
                    <canvas id="tcoBrandChart" width="400" height="300"></canvas>
                </div>
                
                <div class="chart-card">
                    <div class="chart-title">üìä TCO by Category</div>
                    <canvas id="tcoCategoryChart" width="400" height="300"></canvas>
                </div>
                
                <div class="chart-card">
                    <div class="chart-title">üîß Total Cost vs Reliability Score</div>
                    <canvas id="tcoVsReliabilityChart" width="400" height="300"></canvas>
                </div>
                
                <div class="chart-card">
                    <div class="chart-title">üìâ Depreciation vs Purchase Price</div>
                    <canvas id="depreciationChart" width="400" height="300"></canvas>
                </div>
                
                <div class="chart-card">
                    <div class="chart-title">‚ö° Fuel Type TCO Comparison</div>
                    <canvas id="fuelTcoChart" width="400" height="300"></canvas>
                </div>
                
                <div class="chart-card">
                    <div class="chart-title">üí∏ TCO Distribution (All Cars)</div>
                    <canvas id="tcoDistributionChart" width="400" height="300"></canvas>
                </div>
            </div>
            
            <div class="recommendations">
                <h2>üéØ AI-Powered Recommendations</h2>
                <div class="rec-grid">
                    <div class="rec-card">
                        <div class="rec-title">üèÜ Best Overall Value</div>
                        <div id="bestOverall">Loading...</div>
                    </div>
                    <div class="rec-card">
                        <div class="rec-title">üîß Most Reliable</div>
                        <div id="bestImage">Loading...</div>
                    </div>
                    <div class="rec-card">
                        <div class="rec-title">üí∞ Best Budget Option</div>
                        <div id="bestBudget">Loading...</div>
                    </div>
                    <div class="rec-card">
                        <div class="rec-title">üòé Highest Cool Factor</div>
                        <div id="bestPerformance">Loading...</div>
                    </div>
                </div>
            </div>
            
            <!-- Risk Analysis Modal -->
            <div id="riskModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000;">
                <div style="position: relative; margin: 50px auto; width: 80%; max-width: 1000px; background: white; border-radius: 15px; padding: 30px; max-height: 80vh; overflow-y: auto;">
                    <span id="closeModal" style="position: absolute; top: 15px; right: 25px; font-size: 30px; cursor: pointer; color: #666;">&times;</span>
                    <div id="riskContent">
                        <!-- Risk content will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let carData = [];
        let maintenanceData = [];
        let charts = {};
        let carRisks = {};
        
        // Color schemes
        const colorSchemes = {
            primary: ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe', '#00f2fe'],
            secondary: ['#11998e', '#38ef7d', '#fc466b', '#3f5efb', '#f093fb', '#f5576c'],
            categories: {
                'Premium EV': '#667eea',
                'Luxury Sedan': '#764ba2',
                'Hybrid SUV': '#11998e',
                'Sports Car': '#f5576c',
                'Luxury PHEV': '#4facfe',
                'EV SUV': '#38ef7d'
            }
        };
        
        // Initialize dashboard
        async function initDashboard() {
            try {
                await loadData();
                updateStats();
                createCharts();
                updateRecommendations();
                setupFilters();
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
            } catch (error) {
                console.error('Error initializing dashboard:', error);
                document.getElementById('loading').innerHTML = 'Error loading data. Please check the CSV files.';
            }
        }
        
        // Parse CSV line handling quoted fields
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim());
            return result;
        }

        // Load CSV data
        async function loadData() {
            try {
                const response = await fetch('comprehensive_car_analysis.csv');
                const csvText = await response.text();
                const lines = csvText.trim().split('\n');
                const headers = lines[0].split(',');
                
                carData = lines.slice(1).map(line => {
                    const values = parseCSVLine(line);
                    const car = {};
                    headers.forEach((header, index) => {
                        let value = values[index];
                        // Convert numeric fields
                        if (['price_range_low', 'price_range_high', 'annual_fuel_cost', 'tco_3yr_low', 'tco_3yr_high', 
                             'founder_credibility_score', 'reliability_score', 'depreciation_3yr_percent'].includes(header)) {
                            value = parseInt(value) || 0;
                        }
                        car[header] = value;
                    });
                    return car;
                });
                
                console.log(`Loaded ${carData.length} cars from CSV`);
                
            } catch (error) {
                console.error('Error loading CSV:', error);
                alert('Could not load car data. Please make sure comprehensive_car_analysis.csv is in the same directory as this HTML file.');
                return;
                {make: 'Tesla', model: 'Model Y', price_range_low: 30000, price_range_high: 45000, category: 'EV SUV', fuel_type: 'Electric', annual_fuel_cost: 275, tco_3yr_low: 14750, tco_3yr_high: 22600, founder_credibility_score: 3, reliability_score: 8, depreciation_3yr_percent: 42},
                {make: 'Tesla', model: 'Model S', price_range_low: 40000, price_range_high: 70000, category: 'Luxury EV', fuel_type: 'Electric', annual_fuel_cost: 275, tco_3yr_low: 24275, tco_3yr_high: 42775, founder_credibility_score: 6, reliability_score: 7, depreciation_3yr_percent: 45},
                {make: 'BMW', model: 'i4', price_range_low: 40000, price_range_high: 55000, category: 'Luxury EV', fuel_type: 'Electric', annual_fuel_cost: 275, tco_3yr_low: 20075, tco_3yr_high: 29325, founder_credibility_score: 7, reliability_score: 8, depreciation_3yr_percent: 28},
                {make: 'Genesis', model: 'GV60', price_range_low: 45000, price_range_high: 60000, category: 'Luxury EV SUV', fuel_type: 'Electric', annual_fuel_cost: 275, tco_3yr_low: 22675, tco_3yr_high: 31325, founder_credibility_score: 6, reliability_score: 8, depreciation_3yr_percent: 35},
                {make: 'Chevrolet', model: 'Bolt EUV', price_range_low: 15000, price_range_high: 25000, category: 'Budget EV', fuel_type: 'Electric', annual_fuel_cost: 275, tco_3yr_low: 7075, tco_3yr_high: 12575, founder_credibility_score: 2, reliability_score: 6, depreciation_3yr_percent: 50},
                {make: 'Nissan', model: 'Leaf', price_range_low: 12000, price_range_high: 22000, category: 'Budget EV', fuel_type: 'Electric', annual_fuel_cost: 275, tco_3yr_low: 6500, tco_3yr_high: 14500, founder_credibility_score: 1, reliability_score: 5, depreciation_3yr_percent: 55},
                {make: 'Hyundai', model: 'Ioniq 5', price_range_low: 32000, price_range_high: 42000, category: 'EV SUV', fuel_type: 'Electric', annual_fuel_cost: 275, tco_3yr_low: 18500, tco_3yr_high: 25500, founder_credibility_score: 5, reliability_score: 7, depreciation_3yr_percent: 38},
                {make: 'Kia', model: 'EV6', price_range_low: 28000, price_range_high: 38000, category: 'EV SUV', fuel_type: 'Electric', annual_fuel_cost: 275, tco_3yr_low: 16200, tco_3yr_high: 23200, founder_credibility_score: 4, reliability_score: 7, depreciation_3yr_percent: 40},
                
                // PHEVs
                {make: 'BMW', model: '330e', price_range_low: 23000, price_range_high: 27500, category: 'Luxury PHEV', fuel_type: 'PHEV', annual_fuel_cost: 400, tco_3yr_low: 17050, tco_3yr_high: 20350, founder_credibility_score: 6, reliability_score: 7, depreciation_3yr_percent: 38},
                {make: 'Toyota', model: 'Prius Prime', price_range_low: 20000, price_range_high: 28000, category: 'PHEV Hatchback', fuel_type: 'PHEV', annual_fuel_cost: 350, tco_3yr_low: 13250, tco_3yr_high: 20250, founder_credibility_score: 2, reliability_score: 9, depreciation_3yr_percent: 28},
                {make: 'Honda', model: 'Clarity PHEV', price_range_low: 18000, price_range_high: 25000, category: 'PHEV Sedan', fuel_type: 'PHEV', annual_fuel_cost: 380, tco_3yr_low: 12800, tco_3yr_high: 18800, founder_credibility_score: 3, reliability_score: 8, depreciation_3yr_percent: 35},
                
                // Hybrids
                {make: 'Toyota', model: 'RAV4 Hybrid', price_range_low: 26500, price_range_high: 33700, category: 'Hybrid SUV', fuel_type: 'Hybrid', annual_fuel_cost: 800, tco_3yr_low: 18450, tco_3yr_high: 23550, founder_credibility_score: 2, reliability_score: 9, depreciation_3yr_percent: 19},
                {make: 'Toyota', model: 'Camry Hybrid', price_range_low: 23000, price_range_high: 30000, category: 'Hybrid Sedan', fuel_type: 'Hybrid', annual_fuel_cost: 600, tco_3yr_low: 16000, tco_3yr_high: 22200, founder_credibility_score: 2, reliability_score: 9, depreciation_3yr_percent: 22},
                {make: 'Honda', model: 'CR-V Hybrid', price_range_low: 25000, price_range_high: 32000, category: 'Hybrid SUV', fuel_type: 'Hybrid', annual_fuel_cost: 850, tco_3yr_low: 18350, tco_3yr_high: 24350, founder_credibility_score: 3, reliability_score: 8, depreciation_3yr_percent: 24},
                {make: 'Honda', model: 'Accord Hybrid', price_range_low: 22000, price_range_high: 29000, category: 'Hybrid Sedan', fuel_type: 'Hybrid', annual_fuel_cost: 650, tco_3yr_low: 15650, tco_3yr_high: 21650, founder_credibility_score: 3, reliability_score: 9, depreciation_3yr_percent: 25},
                {make: 'Lexus', model: 'ES Hybrid', price_range_low: 25000, price_range_high: 35000, category: 'Luxury Hybrid', fuel_type: 'Hybrid', annual_fuel_cost: 700, tco_3yr_low: 18200, tco_3yr_high: 25200, founder_credibility_score: 5, reliability_score: 9, depreciation_3yr_percent: 28},
                {make: 'Lexus', model: 'NX Hybrid', price_range_low: 28000, price_range_high: 38000, category: 'Luxury Hybrid SUV', fuel_type: 'Hybrid', annual_fuel_cost: 750, tco_3yr_low: 20500, tco_3yr_high: 27500, founder_credibility_score: 5, reliability_score: 9, depreciation_3yr_percent: 26},
                
                // German Luxury Gas
                {make: 'BMW', model: '330i', price_range_low: 20000, price_range_high: 32000, category: 'Luxury Sedan', fuel_type: 'Gas', annual_fuel_cost: 1200, tco_3yr_low: 16100, tco_3yr_high: 24600, founder_credibility_score: 6, reliability_score: 7, depreciation_3yr_percent: 35},
                {make: 'BMW', model: 'M240i', price_range_low: 30000, price_range_high: 42000, category: 'Sports Luxury', fuel_type: 'Gas', annual_fuel_cost: 1400, tco_3yr_low: 22300, tco_3yr_high: 30900, founder_credibility_score: 7, reliability_score: 7, depreciation_3yr_percent: 30},
                {make: 'BMW', model: 'X3', price_range_low: 28000, price_range_high: 40000, category: 'Luxury SUV', fuel_type: 'Gas', annual_fuel_cost: 1350, tco_3yr_low: 21200, tco_3yr_high: 29200, founder_credibility_score: 6, reliability_score: 7, depreciation_3yr_percent: 32},
                {make: 'Audi', model: 'A4', price_range_low: 22000, price_range_high: 32000, category: 'Luxury Sedan', fuel_type: 'Gas', annual_fuel_cost: 1200, tco_3yr_low: 17700, tco_3yr_high: 25700, founder_credibility_score: 6, reliability_score: 7, depreciation_3yr_percent: 30},
                {make: 'Audi', model: 'Q5', price_range_low: 28000, price_range_high: 40000, category: 'Luxury SUV', fuel_type: 'Gas', annual_fuel_cost: 1300, tco_3yr_low: 21100, tco_3yr_high: 29100, founder_credibility_score: 6, reliability_score: 7, depreciation_3yr_percent: 33},
                {make: 'Mercedes', model: 'C300', price_range_low: 25000, price_range_high: 35000, category: 'Luxury Sedan', fuel_type: 'Gas', annual_fuel_cost: 1300, tco_3yr_low: 20300, tco_3yr_high: 28300, founder_credibility_score: 6, reliability_score: 6, depreciation_3yr_percent: 32},
                
                // Korean Luxury
                {make: 'Genesis', model: 'G70', price_range_low: 19000, price_range_high: 28000, category: 'Luxury Sedan', fuel_type: 'Gas', annual_fuel_cost: 1400, tco_3yr_low: 13700, tco_3yr_high: 19900, founder_credibility_score: 5, reliability_score: 8, depreciation_3yr_percent: 44},
                {make: 'Genesis', model: 'G80', price_range_low: 28000, price_range_high: 42000, category: 'Luxury Sedan', fuel_type: 'Gas', annual_fuel_cost: 1400, tco_3yr_low: 19700, tco_3yr_high: 28750, founder_credibility_score: 5, reliability_score: 8, depreciation_3yr_percent: 40},
                {make: 'Genesis', model: 'GV70', price_range_low: 32000, price_range_high: 45000, category: 'Luxury SUV', fuel_type: 'Gas', annual_fuel_cost: 1500, tco_3yr_low: 24200, tco_3yr_high: 32400, founder_credibility_score: 5, reliability_score: 8, depreciation_3yr_percent: 35},
                
                // Sports Cars
                {make: 'Porsche', model: 'Cayman', price_range_low: 35000, price_range_high: 55000, category: 'Sports Car', fuel_type: 'Gas', annual_fuel_cost: 1600, tco_3yr_low: 27200, tco_3yr_high: 39700, founder_credibility_score: 8, reliability_score: 9, depreciation_3yr_percent: 20},
                {make: 'Porsche', model: 'Boxster', price_range_low: 30000, price_range_high: 50000, category: 'Sports Car', fuel_type: 'Gas', annual_fuel_cost: 1600, tco_3yr_low: 24700, tco_3yr_high: 35700, founder_credibility_score: 8, reliability_score: 9, depreciation_3yr_percent: 22},
                {make: 'Toyota', model: 'GR86', price_range_low: 25000, price_range_high: 32000, category: 'Sports Car', fuel_type: 'Gas', annual_fuel_cost: 1600, tco_3yr_low: 19700, tco_3yr_high: 25200, founder_credibility_score: 4, reliability_score: 8, depreciation_3yr_percent: 25},
                {make: 'Mazda', model: 'MX-5 Miata', price_range_low: 18000, price_range_high: 28000, category: 'Sports Car', fuel_type: 'Gas', annual_fuel_cost: 1300, tco_3yr_low: 15500, tco_3yr_high: 22500, founder_credibility_score: 4, reliability_score: 8, depreciation_3yr_percent: 28},
                {make: 'BMW', model: 'M2', price_range_low: 40000, price_range_high: 55000, category: 'Sports Car', fuel_type: 'Gas', annual_fuel_cost: 1700, tco_3yr_low: 30200, tco_3yr_high: 40200, founder_credibility_score: 8, reliability_score: 7, depreciation_3yr_percent: 25},
                
                // Japanese Luxury
                {make: 'Lexus', model: 'IS', price_range_low: 22000, price_range_high: 32000, category: 'Luxury Sedan', fuel_type: 'Gas', annual_fuel_cost: 1500, tco_3yr_low: 16900, tco_3yr_high: 24400, founder_credibility_score: 4, reliability_score: 9, depreciation_3yr_percent: 25},
                {make: 'Acura', model: 'TLX', price_range_low: 20000, price_range_high: 30000, category: 'Luxury Sedan', fuel_type: 'Gas', annual_fuel_cost: 1400, tco_3yr_low: 16100, tco_3yr_high: 23600, founder_credibility_score: 3, reliability_score: 8, depreciation_3yr_percent: 30},
                {make: 'Acura', model: 'RDX', price_range_low: 25000, price_range_high: 35000, category: 'Luxury SUV', fuel_type: 'Gas', annual_fuel_cost: 1500, tco_3yr_low: 19450, tco_3yr_high: 26950, founder_credibility_score: 3, reliability_score: 8, depreciation_3yr_percent: 28},
                {make: 'Infiniti', model: 'Q50', price_range_low: 18000, price_range_high: 28000, category: 'Luxury Sedan', fuel_type: 'Gas', annual_fuel_cost: 1550, tco_3yr_low: 15550, tco_3yr_high: 22550, founder_credibility_score: 3, reliability_score: 6, depreciation_3yr_percent: 35},
                
                // Regular Gas Cars
                {make: 'Honda', model: 'Civic', price_range_low: 15000, price_range_high: 25000, category: 'Compact Sedan', fuel_type: 'Gas', annual_fuel_cost: 1000, tco_3yr_low: 12200, tco_3yr_high: 19200, founder_credibility_score: 1, reliability_score: 9, depreciation_3yr_percent: 28},
                {make: 'Toyota', model: 'Corolla', price_range_low: 14000, price_range_high: 22000, category: 'Compact Sedan', fuel_type: 'Gas', annual_fuel_cost: 950, tco_3yr_low: 11500, tco_3yr_high: 17500, founder_credibility_score: 1, reliability_score: 9, depreciation_3yr_percent: 26},
                {make: 'Mazda', model: 'CX-5', price_range_low: 18000, price_range_high: 28000, category: 'Compact SUV', fuel_type: 'Gas', annual_fuel_cost: 1200, tco_3yr_low: 14700, tco_3yr_high: 22700, founder_credibility_score: 2, reliability_score: 8, depreciation_3yr_percent: 30},
                {make: 'Subaru', model: 'Outback', price_range_low: 22000, price_range_high: 32000, category: 'SUV Wagon', fuel_type: 'Gas', annual_fuel_cost: 1250, tco_3yr_low: 17200, tco_3yr_high: 25200, founder_credibility_score: 2, reliability_score: 8, depreciation_3yr_percent: 28},
                
                // More Budget Options
                {make: 'Mitsubishi', model: 'Outlander', price_range_low: 16000, price_range_high: 26000, category: 'Compact SUV', fuel_type: 'Gas', annual_fuel_cost: 1300, tco_3yr_low: 14200, tco_3yr_high: 22200, founder_credibility_score: 1, reliability_score: 6, depreciation_3yr_percent: 40},
                {make: 'Nissan', model: 'Sentra', price_range_low: 12000, price_range_high: 20000, category: 'Compact Sedan', fuel_type: 'Gas', annual_fuel_cost: 1050, tco_3yr_low: 10800, tco_3yr_high: 17800, founder_credibility_score: 1, reliability_score: 7, depreciation_3yr_percent: 35},
                {make: 'Hyundai', model: 'Elantra', price_range_low: 13000, price_range_high: 21000, category: 'Compact Sedan', fuel_type: 'Gas', annual_fuel_cost: 1000, tco_3yr_low: 11400, tco_3yr_high: 18400, founder_credibility_score: 1, reliability_score: 7, depreciation_3yr_percent: 38},
                {make: 'Kia', model: 'Forte', price_range_low: 12500, price_range_high: 20500, category: 'Compact Sedan', fuel_type: 'Gas', annual_fuel_cost: 1020, tco_3yr_low: 11200, tco_3yr_high: 18200, founder_credibility_score: 1, reliability_score: 7, depreciation_3yr_percent: 36},
                {make: 'Chevrolet', model: 'Malibu', price_range_low: 14000, price_range_high: 22000, category: 'Midsize Sedan', fuel_type: 'Gas', annual_fuel_cost: 1100, tco_3yr_low: 12500, tco_3yr_high: 19500, founder_credibility_score: 1, reliability_score: 6, depreciation_3yr_percent: 42},
                
                // More SUVs
                {make: 'Ford', model: 'Escape', price_range_low: 16000, price_range_high: 26000, category: 'Compact SUV', fuel_type: 'Gas', annual_fuel_cost: 1250, tco_3yr_low: 14300, tco_3yr_high: 22300, founder_credibility_score: 2, reliability_score: 6, depreciation_3yr_percent: 40},
                {make: 'Chevrolet', model: 'Equinox', price_range_low: 15000, price_range_high: 25000, category: 'Compact SUV', fuel_type: 'Gas', annual_fuel_cost: 1280, tco_3yr_low: 13800, tco_3yr_high: 21800, founder_credibility_score: 1, reliability_score: 6, depreciation_3yr_percent: 43},
                {make: 'Jeep', model: 'Compass', price_range_low: 16000, price_range_high: 26000, category: 'Compact SUV', fuel_type: 'Gas', annual_fuel_cost: 1320, tco_3yr_low: 14400, tco_3yr_high: 22400, founder_credibility_score: 2, reliability_score: 5, depreciation_3yr_percent: 45},
                {make: 'Subaru', model: 'Forester', price_range_low: 20000, price_range_high: 30000, category: 'Compact SUV', fuel_type: 'Gas', annual_fuel_cost: 1200, tco_3yr_low: 16200, tco_3yr_high: 24200, founder_credibility_score: 2, reliability_score: 8, depreciation_3yr_percent: 30},
                {make: 'Honda', model: 'Pilot', price_range_low: 28000, price_range_high: 38000, category: 'Midsize SUV', fuel_type: 'Gas', annual_fuel_cost: 1450, tco_3yr_low: 22200, tco_3yr_high: 30200, founder_credibility_score: 3, reliability_score: 8, depreciation_3yr_percent: 32},
                
                // Trucks
                {make: 'Toyota', model: 'Tacoma', price_range_low: 25000, price_range_high: 35000, category: 'Pickup Truck', fuel_type: 'Gas', annual_fuel_cost: 1600, tco_3yr_low: 20500, tco_3yr_high: 28500, founder_credibility_score: 3, reliability_score: 8, depreciation_3yr_percent: 25},
                {make: 'Ford', model: 'F-150', price_range_low: 22000, price_range_high: 45000, category: 'Pickup Truck', fuel_type: 'Gas', annual_fuel_cost: 1800, tco_3yr_low: 19800, tco_3yr_high: 36800, founder_credibility_score: 3, reliability_score: 7, depreciation_3yr_percent: 38},
                {make: 'Chevrolet', model: 'Silverado', price_range_low: 20000, price_range_high: 42000, category: 'Pickup Truck', fuel_type: 'Gas', annual_fuel_cost: 1850, tco_3yr_low: 19200, tco_3yr_high: 35200, founder_credibility_score: 2, reliability_score: 6, depreciation_3yr_percent: 40},
                
                // More Luxury Options
                {make: 'Volvo', model: 'XC40', price_range_low: 24000, price_range_high: 34000, category: 'Luxury SUV', fuel_type: 'Gas', annual_fuel_cost: 1300, tco_3yr_low: 19200, tco_3yr_high: 27200, founder_credibility_score: 5, reliability_score: 7, depreciation_3yr_percent: 35},
                {make: 'Cadillac', model: 'XT4', price_range_low: 22000, price_range_high: 32000, category: 'Luxury SUV', fuel_type: 'Gas', annual_fuel_cost: 1350, tco_3yr_low: 18500, tco_3yr_high: 26500, founder_credibility_score: 4, reliability_score: 5, depreciation_3yr_percent: 45},
                {make: 'Lincoln', model: 'Corsair', price_range_low: 24000, price_range_high: 34000, category: 'Luxury SUV', fuel_type: 'Gas', annual_fuel_cost: 1320, tco_3yr_low: 19100, tco_3yr_high: 27100, founder_credibility_score: 4, reliability_score: 6, depreciation_3yr_percent: 42},
                
                // More EVs
                {make: 'Volkswagen', model: 'ID.4', price_range_low: 25000, price_range_high: 35000, category: 'EV SUV', fuel_type: 'Electric', annual_fuel_cost: 275, tco_3yr_low: 17200, tco_3yr_high: 24200, founder_credibility_score: 4, reliability_score: 6, depreciation_3yr_percent: 45},
                {make: 'Ford', model: 'Mustang Mach-E', price_range_low: 32000, price_range_high: 48000, category: 'EV SUV', fuel_type: 'Electric', annual_fuel_cost: 275, tco_3yr_low: 21500, tco_3yr_high: 32500, founder_credibility_score: 6, reliability_score: 6, depreciation_3yr_percent: 40},
                {make: 'Polestar', model: '2', price_range_low: 30000, price_range_high: 42000, category: 'EV Sedan', fuel_type: 'Electric', annual_fuel_cost: 275, tco_3yr_low: 19800, tco_3yr_high: 28800, founder_credibility_score: 6, reliability_score: 7, depreciation_3yr_percent: 38},
                
                // Performance Cars
                {make: 'Ford', model: 'Mustang GT', price_range_low: 28000, price_range_high: 38000, category: 'Sports Car', fuel_type: 'Gas', annual_fuel_cost: 1700, tco_3yr_low: 22400, tco_3yr_high: 30400, founder_credibility_score: 5, reliability_score: 7, depreciation_3yr_percent: 32},
                {make: 'Chevrolet', model: 'Camaro', price_range_low: 25000, price_range_high: 40000, category: 'Sports Car', fuel_type: 'Gas', annual_fuel_cost: 1650, tco_3yr_low: 20800, tco_3yr_high: 32800, founder_credibility_score: 5, reliability_score: 6, depreciation_3yr_percent: 38},
                {make: 'Dodge', model: 'Charger', price_range_low: 22000, price_range_high: 35000, category: 'Sports Sedan', fuel_type: 'Gas', annual_fuel_cost: 1600, tco_3yr_low: 18600, tco_3yr_high: 28600, founder_credibility_score: 4, reliability_score: 6, depreciation_3yr_percent: 40},
                {make: 'Subaru', model: 'WRX', price_range_low: 24000, price_range_high: 32000, category: 'Sports Sedan', fuel_type: 'Gas', annual_fuel_cost: 1500, tco_3yr_low: 19200, tco_3yr_high: 25200, founder_credibility_score: 5, reliability_score: 7, depreciation_3yr_percent: 28}
            ];
            
            maintenanceData = [
                {make: 'BMW', model: '330e', year_1_cost: 150, year_3_cost: 650, year_5_cost: 1200, total_5yr_cost: 3300},
                {make: 'Tesla', model: 'Model 3', year_1_cost: 100, year_3_cost: 300, year_5_cost: 800, total_5yr_cost: 1900},
                {make: 'Genesis', model: 'G70', year_1_cost: 200, year_3_cost: 200, year_5_cost: 800, total_5yr_cost: 1600},
                {make: 'Toyota', model: 'RAV4 Hybrid', year_1_cost: 250, year_3_cost: 350, year_5_cost: 500, total_5yr_cost: 1800},
                {make: 'Porsche', model: 'Cayman', year_1_cost: 400, year_3_cost: 800, year_5_cost: 1500, total_5yr_cost: 4500},
                {make: 'Lexus', model: 'ES Hybrid', year_1_cost: 200, year_3_cost: 300, year_5_cost: 400, total_5yr_cost: 1500}
            ];
            
            // Risk data for each car
            carRisks = {
                'Genesis G70': {
                    major_risks: [
                        'üî• BRUTAL 44% depreciation in 3 years - fastest on list',
                        '‚ö†Ô∏è New brand = unknown long-term reliability',
                        'üí∏ Limited service network outside major cities',
                        'üîß Parts availability concerns after warranty'
                    ],
                    medium_risks: [
                        'Hyundai/Genesis still building reputation vs German luxury',
                        'Resale market relatively small vs BMW/Audi',
                        'Premium gas required (adds $200-300/year)',
                        'Insurance may be higher for new luxury brand'
                    ],
                    why_still_good: [
                        '‚úÖ FREE maintenance for 3 years saves $2000+',
                        '‚úÖ 10yr/100k powertrain warranty = excellent coverage',
                        '‚úÖ Low entry price offsets high depreciation',
                        '‚úÖ Superior quality vs price compared to Germans',
                        '‚úÖ Current 2022 models at $22.9k already took biggest hit'
                    ],
                    actual_cost_analysis: '$19-28k entry, $13.7-19.9k TCO = best value despite depreciation cliff',
                    founder_perspective: 'Signals "I research quality before buying" vs "I bought the obvious choice"'
                },
                'Tesla Model 3': {
                    major_risks: [
                        'üîã Battery replacement $15-20k if out of warranty',
                        '‚ö° Supercharger network changes/pricing unpredictable',
                        'üõ†Ô∏è Tesla service quality inconsistent, long waits',
                        'üì± Over-the-air updates can brick features'
                    ],
                    medium_risks: [
                        'Build quality issues on older models (2018-2020)',
                        'Door handles, trunk issues common',
                        'Paint quality below luxury standards',
                        'Insurance costs higher due to repair complexity'
                    ],
                    why_still_good: [
                        '‚úÖ Prices crashed 16.8% = amazing deals now',
                        '‚úÖ 8yr battery warranty still covers most used models',
                        '‚úÖ No oil changes, minimal maintenance',
                        '‚úÖ Supercharger network still best in class',
                        '‚úÖ Software updates add value over time'
                    ],
                    actual_cost_analysis: '2021 models avg $23k, $8-13.6k TCO = incredible value if you avoid battery issues',
                    founder_perspective: 'Basic tech worker car in SF - no differentiation value, just transportation'
                },
                'BMW 330e': {
                    major_risks: [
                        'üí∞ BMW service costs $800-1200/year after warranty',
                        'üîß Complex PHEV system = more things to break',
                        '‚ö° Small battery (6kWh) degrades faster than large EV packs',
                        'üõ†Ô∏è Turbo engine + hybrid = premium repair costs'
                    ],
                    medium_risks: [
                        'Requires premium gas when not on electric',
                        'BMW reliability rating only 2.5/5.0',
                        'Oil changes still $250+ at dealer',
                        'Depreciation continues after initial hit'
                    ],
                    why_still_good: [
                        '‚úÖ Already took 38% depreciation hit in 3 years',
                        '‚úÖ PHEV system proven reliable in this generation',
                        '‚úÖ 3yr/36k warranty coverage on used models',
                        '‚úÖ Electric range covers daily commute',
                        '‚úÖ Gas backup eliminates range anxiety'
                    ],
                    actual_cost_analysis: '2022 models $27.5k resale, $17-20.4k TCO = luxury credibility at reasonable cost',
                    founder_perspective: 'Smart luxury choice - shows sophistication without flashiness'
                },
                'Toyota RAV4 Hybrid': {
                    major_risks: [
                        'üò¥ BORING - signals budget optimization over success',
                        'üêå Slow acceleration, CVT transmission feel',
                        'üì± Infotainment system lags behind luxury brands',
                        'üéµ Road noise higher than luxury competitors'
                    ],
                    medium_risks: [
                        'Waiting lists at dealers for new models',
                        'Limited luxury features vs German brands',
                        'Resale so good you pay premium even used',
                        'Interior materials feel cheap vs luxury cars'
                    ],
                    why_still_good: [
                        '‚úÖ Only 19% depreciation = best value retention',
                        '‚úÖ Toyota reliability legendary',
                        '‚úÖ Hybrid system bulletproof',
                        '‚úÖ $800/year fuel costs vs $1400+ for gas',
                        '‚úÖ Will run 200k+ miles without issues'
                    ],
                    actual_cost_analysis: '2023 avg $33.7k, $18.4-23.6k TCO = higher upfront but holds value',
                    founder_perspective: 'Screams "I optimize spreadsheets" - terrible for founder image'
                },
                'BMW i4': {
                    major_risks: [
                        'üí∏ $40-55k entry price = major cash outlay',
                        'üîã EV depreciation 28% in 3 years',
                        '‚ö° BMW charging network limited vs Tesla',
                        'üõ†Ô∏è New model = unknown long-term reliability'
                    ],
                    medium_risks: [
                        'BMW service costs apply to EV components',
                        'Software bugs common in first-gen BMW EVs',
                        'Range anxiety vs Tesla network',
                        'Charging at home requires 240V setup'
                    ],
                    why_still_good: [
                        '‚úÖ $7500 federal tax credit if buying new',
                        '‚úÖ German luxury interior vs Tesla',
                        '‚úÖ 270+ mile range handles SF commute',
                        '‚úÖ BMW badge credibility in business settings',
                        '‚úÖ Maintenance minimal like all EVs'
                    ],
                    actual_cost_analysis: '$30.5-45.5k after credits, $20-29.3k TCO = premium but justifiable for luxury EV',
                    founder_perspective: 'Excellent founder credibility - luxury EV without Tesla basic-ness'
                },
                'Porsche Cayman': {
                    major_risks: [
                        'üí∞ $35-55k entry + $4500 maintenance over 5 years',
                        'üè• Expensive repairs when things break',
                        '‚õΩ Premium gas + 22mpg = $1600/year fuel',
                        'üöó Impractical as only car (2 seats, no cargo)'
                    ],
                    medium_risks: [
                        'Insurance costs significantly higher',
                        'Not practical for moving/Costco runs',
                        'Attention-grabbing (good or bad)',
                        'Depreciation 20% but on high base price'
                    ],
                    why_still_good: [
                        '‚úÖ 10/10 founder credibility - peak status symbol',
                        '‚úÖ Porsche reliability excellent after warranty',
                        '‚úÖ Holds value better than other sports cars',
                        '‚úÖ Driving experience unmatched',
                        '‚úÖ "I can afford to be impractical" signal'
                    ],
                    actual_cost_analysis: '$35-55k entry, $27.2-39.7k TCO = expensive but ultimate founder flex',
                    founder_perspective: 'Peak "I have made it" signal - worth premium if image ROI matters'
                }
            };
        }
        
        // Update statistics
        function updateStats() {
            const filtered = getFilteredData();
            
            document.getElementById('totalCars').textContent = filtered.length;
            
            const avgTCO = filtered.reduce((sum, car) => sum + ((car.tco_3yr_low + car.tco_3yr_high) / 2), 0) / filtered.length;
            document.getElementById('avgTCO').textContent = `$${Math.round(avgTCO).toLocaleString()}`;
            
            const bestValue = filtered.reduce((best, car) => {
                const avgTCO = (car.tco_3yr_low + car.tco_3yr_high) / 2;
                const bestAvgTCO = (best.tco_3yr_low + best.tco_3yr_high) / 2;
                return avgTCO < bestAvgTCO ? car : best;
            });
            document.getElementById('bestValue').textContent = `${bestValue.make} ${bestValue.model}`;
            
            const topCredibility = filtered.reduce((best, car) => 
                car.founder_credibility_score > best.founder_credibility_score ? car : best
            );
            document.getElementById('topCredibility').textContent = `${topCredibility.make} ${topCredibility.model}`;
        }
        
        // Get filtered data based on current filter settings
        function getFilteredData() {
            let filtered = [...carData];
            
            // Budget filter
            const budgetFilter = document.getElementById('budgetFilter')?.value;
            if (budgetFilter && budgetFilter !== 'all') {
                filtered = filtered.filter(car => {
                    const avgPrice = (car.price_range_low + car.price_range_high) / 2;
                    switch(budgetFilter) {
                        case 'under15k': return avgPrice < 15000;
                        case '15to25k': return avgPrice >= 15000 && avgPrice < 25000;
                        case '25to35k': return avgPrice >= 25000 && avgPrice < 35000;
                        case '35to50k': return avgPrice >= 35000 && avgPrice < 50000;
                        case 'over50k': return avgPrice >= 50000;
                        default: return true;
                    }
                });
            }
            
            // Brand filter
            const brandFilter = document.getElementById('brandFilter')?.value;
            if (brandFilter && brandFilter !== 'all') {
                filtered = filtered.filter(car => car.make === brandFilter);
            }
            
            // Category filter
            const categoryFilter = document.getElementById('categoryFilter')?.value;
            if (categoryFilter && categoryFilter !== 'all') {
                filtered = filtered.filter(car => {
                    switch(categoryFilter) {
                        case 'Budget': return car.category.includes('Budget') || car.category.includes('Compact');
                        case 'Luxury': return car.category.includes('Luxury');
                        case 'Sports': return car.category.includes('Sports');
                        case 'SUV': return car.category.includes('SUV');
                        case 'Sedan': return car.category.includes('Sedan');
                        case 'EV': return car.category.includes('EV') || car.fuel_type === 'Electric';
                        case 'Hybrid': return car.category.includes('Hybrid') || car.fuel_type === 'Hybrid' || car.fuel_type === 'PHEV';
                        case 'Truck': return car.category.includes('Truck');
                        default: return true;
                    }
                });
            }
            
            // Fuel filter
            const fuelFilter = document.getElementById('fuelFilter')?.value;
            if (fuelFilter && fuelFilter !== 'all') {
                filtered = filtered.filter(car => car.fuel_type === fuelFilter);
            }
            
            // Credibility filter
            const credibilityFilter = document.getElementById('credibilityFilter')?.value;
            if (credibilityFilter) {
                filtered = filtered.filter(car => car.founder_credibility_score >= parseInt(credibilityFilter));
            }
            
            // Reliability filter
            const reliabilityFilter = document.getElementById('reliabilityFilter')?.value;
            if (reliabilityFilter && reliabilityFilter !== 'all') {
                const minReliability = parseInt(reliabilityFilter);
                filtered = filtered.filter(car => car.reliability_score >= minReliability);
            }
            
            return filtered;
        }
        
        // Create all charts
        function createCharts() {
            createTCOByBrandChart();
            createTCOByCategoryChart();
            createTCOVsReliabilityChart();
            createDepreciationChart();
            createFuelTCOChart();
            createTCODistributionChart();
        }
        
        // TCO by Brand chart
        function createTCOByBrandChart() {
            const ctx = document.getElementById('tcoBrandChart').getContext('2d');
            const filtered = getFilteredData();
            
            // Group by brand and calculate average TCO
            const brands = {};
            filtered.forEach(car => {
                if (!brands[car.make]) {
                    brands[car.make] = [];
                }
                brands[car.make].push((car.tco_3yr_low + car.tco_3yr_high) / 2);
            });
            
            const brandData = Object.keys(brands)
                .map(brand => ({
                    brand: brand,
                    avgTCO: brands[brand].reduce((sum, tco) => sum + tco, 0) / brands[brand].length,
                    count: brands[brand].length
                }))
                .filter(b => b.count >= 1) // Only brands with at least 1 car
                .sort((a, b) => a.avgTCO - b.avgTCO); // Sort by TCO
            
            charts.tcoBrand = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: brandData.map(b => b.brand),
                    datasets: [{
                        label: 'Average 3-Year TCO',
                        data: brandData.map(b => b.avgTCO),
                        backgroundColor: colorSchemes.primary,
                        borderColor: colorSchemes.primary,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    indexAxis: 'y', // Horizontal bars
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: '3-Year TCO ($)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + (value / 1000).toFixed(0) + 'k';
                                }
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Brand'
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const brand = brandData[context.dataIndex];
                                    return `${brand.brand}: $${context.parsed.x.toLocaleString()} (${brand.count} models)`;
                                }
                            }
                        },
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        // TCO by Category chart  
        function createTCOByCategoryChart() {
            const ctx = document.getElementById('tcoCategoryChart').getContext('2d');
            const filtered = getFilteredData();
            
            // Group by category and calculate average TCO
            const categories = {};
            filtered.forEach(car => {
                // Simplify category names
                let category = car.category;
                if (category.includes('Luxury')) category = 'Luxury';
                else if (category.includes('Sports')) category = 'Sports';
                else if (category.includes('EV') || category.includes('Electric')) category = 'Electric';
                else if (category.includes('Hybrid')) category = 'Hybrid';
                else if (category.includes('SUV')) category = 'SUV';
                else if (category.includes('Sedan')) category = 'Sedan';
                else if (category.includes('Truck')) category = 'Truck';
                else if (category.includes('Compact') || category.includes('Budget')) category = 'Budget';
                
                if (!categories[category]) {
                    categories[category] = [];
                }
                categories[category].push((car.tco_3yr_low + car.tco_3yr_high) / 2);
            });
            
            const categoryData = Object.keys(categories)
                .map(cat => ({
                    category: cat,
                    avgTCO: categories[cat].reduce((sum, tco) => sum + tco, 0) / categories[cat].length,
                    count: categories[cat].length
                }))
                .sort((a, b) => a.avgTCO - b.avgTCO);
            
            charts.tcoCategory = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: categoryData.map(c => `${c.category} ($${(c.avgTCO / 1000).toFixed(0)}k)`),
                    datasets: [{
                        data: categoryData.map(c => c.avgTCO),
                        backgroundColor: colorSchemes.secondary.slice(0, categoryData.length),
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const cat = categoryData[context.dataIndex];
                                    return `${cat.category}: $${context.parsed.toLocaleString()} avg (${cat.count} cars)`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Fuel Type TCO Comparison
        function createFuelTCOChart() {
            const ctx = document.getElementById('fuelTcoChart').getContext('2d');
            const filtered = getFilteredData();
            
            // Group by fuel type
            const fuelTypes = {};
            filtered.forEach(car => {
                if (!fuelTypes[car.fuel_type]) {
                    fuelTypes[car.fuel_type] = [];
                }
                fuelTypes[car.fuel_type].push((car.tco_3yr_low + car.tco_3yr_high) / 2);
            });
            
            const fuelData = Object.keys(fuelTypes).map(fuel => ({
                fuel: fuel,
                avgTCO: fuelTypes[fuel].reduce((sum, tco) => sum + tco, 0) / fuelTypes[fuel].length,
                minTCO: Math.min(...fuelTypes[fuel]),
                maxTCO: Math.max(...fuelTypes[fuel]),
                count: fuelTypes[fuel].length
            }));
            
            charts.fuelTco = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: fuelData.map(f => f.fuel),
                    datasets: [{
                        label: 'Average TCO',
                        data: fuelData.map(f => f.avgTCO),
                        backgroundColor: ['#667eea', '#38ef7d', '#f093fb', '#f5576c'],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: '3-Year TCO ($)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + (value / 1000) + 'k';
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const fuel = fuelData[context.dataIndex];
                                    return `${fuel.fuel}: $${context.parsed.y.toLocaleString()} avg (${fuel.count} cars)`;
                                }
                            }
                        },
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        // TCO Distribution histogram
        function createTCODistributionChart() {
            const ctx = document.getElementById('tcoDistributionChart').getContext('2d');
            const filtered = getFilteredData();
            
            const tcos = filtered.map(car => (car.tco_3yr_low + car.tco_3yr_high) / 2);
            
            // Create bins for histogram
            const bins = [
                { label: '<$10k', min: 0, max: 10000, count: 0 },
                { label: '$10-15k', min: 10000, max: 15000, count: 0 },
                { label: '$15-20k', min: 15000, max: 20000, count: 0 },
                { label: '$20-25k', min: 20000, max: 25000, count: 0 },
                { label: '$25-30k', min: 25000, max: 30000, count: 0 },
                { label: '$30k+', min: 30000, max: Infinity, count: 0 }
            ];
            
            tcos.forEach(tco => {
                bins.find(bin => tco >= bin.min && tco < bin.max).count++;
            });
            
            charts.tcoDistribution = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: bins.map(b => b.label),
                    datasets: [{
                        label: 'Number of Cars',
                        data: bins.map(b => b.count),
                        backgroundColor: colorSchemes.primary[0],
                        borderColor: colorSchemes.primary[0],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'TCO Range'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Number of Cars'
                            },
                            ticks: {
                                stepSize: 1
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.parsed.y} cars in ${context.label} range`;
                                }
                            }
                        },
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        // TCO vs Reliability scatter plot
        function createTCOVsReliabilityChart() {
            const ctx = document.getElementById('tcoVsReliabilityChart').getContext('2d');
            const data = getFilteredData().map(car => ({
                x: car.reliability_score,
                y: (car.tco_3yr_low + car.tco_3yr_high) / 2,
                label: `${car.make} ${car.model}`,
                credibility: car.founder_credibility_score,
                backgroundColor: colorSchemes.categories[car.category] || colorSchemes.primary[0]
            }));
            
            charts.tcoVsReliability = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Cars',
                        data: data,
                        backgroundColor: data.map(d => d.backgroundColor),
                        borderColor: data.map(d => d.backgroundColor),
                        pointRadius: 8,
                        pointHoverRadius: 12
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Reliability Score (1-10)'
                            },
                            min: 5,
                            max: 10
                        },
                        y: {
                            title: {
                                display: true,
                                text: '3-Year TCO ($)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const point = context.raw;
                                    return `${point.label}: $${point.y.toLocaleString()} TCO, ${point.x}/10 reliability, ${point.credibility}/10 cool factor`;
                                }
                            }
                        },
                        legend: {
                            display: false
                        }
                    },
                    onClick: function(event, elements) {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const carName = data[index].label;
                            showRiskAnalysis(carName);
                        }
                    }
                }
            });
        }
        
        // Depreciation vs Price chart
        function createDepreciationChart() {
            const ctx = document.getElementById('depreciationChart').getContext('2d');
            const data = getFilteredData().map(car => ({
                x: (car.price_range_low + car.price_range_high) / 2,
                y: car.depreciation_3yr_percent,
                label: `${car.make} ${car.model}`,
                backgroundColor: colorSchemes.categories[car.category] || colorSchemes.primary[1]
            }));
            
            charts.depreciation = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Depreciation',
                        data: data,
                        backgroundColor: data.map(d => d.backgroundColor),
                        borderColor: data.map(d => d.backgroundColor),
                        pointRadius: 8,
                        pointHoverRadius: 12
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Average Price ($)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + (value / 1000) + 'k';
                                }
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: '3-Year Depreciation (%)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const point = context.raw;
                                    return `${point.label}: $${point.x.toLocaleString()}, ${point.y}% depreciation`;
                                }
                            }
                        },
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        // Category comparison chart
        function createCategoryChart() {
            const ctx = document.getElementById('categoryChart').getContext('2d');
            const filtered = getFilteredData();
            
            // Group by category and find best value in each
            const categories = {};
            filtered.forEach(car => {
                const avgTCO = (car.tco_3yr_low + car.tco_3yr_high) / 2;
                if (!categories[car.category] || avgTCO < categories[car.category].avgTCO) {
                    categories[car.category] = {
                        ...car,
                        avgTCO: avgTCO
                    };
                }
            });
            
            const labels = Object.keys(categories);
            const tcoData = labels.map(cat => categories[cat].avgTCO);
            const credibilityData = labels.map(cat => categories[cat].founder_credibility_score);
            
            charts.category = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '3-Year TCO',
                        data: tcoData,
                        backgroundColor: labels.map(cat => colorSchemes.categories[cat] || colorSchemes.primary[0]),
                        borderColor: labels.map(cat => colorSchemes.categories[cat] || colorSchemes.primary[0]),
                        borderWidth: 2,
                        yAxisID: 'y'
                    }, {
                        label: 'Credibility Score',
                        data: credibilityData,
                        type: 'line',
                        borderColor: '#f5576c',
                        backgroundColor: 'rgba(245, 87, 108, 0.1)',
                        borderWidth: 3,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    const cat = context[0].label;
                                    const car = categories[cat];
                                    return `${car.make} ${car.model}`;
                                },
                                label: function(context) {
                                    if (context.datasetIndex === 0) {
                                        return `TCO: $${context.parsed.y.toLocaleString()}`;
                                    } else {
                                        return `Credibility: ${context.parsed.y}/10`;
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Car Category'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: '3-Year TCO ($)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + (value / 1000) + 'k';
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Credibility Score'
                            },
                            min: 0,
                            max: 10,
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
        }
        
        // Fuel cost comparison
        function createFuelCostChart() {
            const ctx = document.getElementById('fuelCostChart').getContext('2d');
            const filtered = getFilteredData();
            
            // Group by fuel type
            const fuelTypes = {};
            filtered.forEach(car => {
                if (!fuelTypes[car.fuel_type]) {
                    fuelTypes[car.fuel_type] = [];
                }
                fuelTypes[car.fuel_type].push(car.annual_fuel_cost);
            });
            
            const labels = Object.keys(fuelTypes);
            const avgCosts = labels.map(type => 
                fuelTypes[type].reduce((sum, cost) => sum + cost, 0) / fuelTypes[type].length
            );
            
            charts.fuelCost = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: avgCosts,
                        backgroundColor: colorSchemes.secondary.slice(0, labels.length),
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: $${context.parsed.toLocaleString()}/year`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Maintenance costs over time
        function createMaintenanceChart() {
            const ctx = document.getElementById('maintenanceChart').getContext('2d');
            
            const years = ['Year 1', 'Year 2', 'Year 3', 'Year 4', 'Year 5'];
            const datasets = maintenanceData.map((car, index) => ({
                label: `${car.make} ${car.model}`,
                data: [
                    car.year_1_cost,
                    car.year_1_cost + (car.year_3_cost - car.year_1_cost) / 2,
                    car.year_3_cost,
                    car.year_3_cost + (car.year_5_cost - car.year_3_cost) / 2,
                    car.year_5_cost
                ],
                borderColor: colorSchemes.primary[index % colorSchemes.primary.length],
                backgroundColor: colorSchemes.primary[index % colorSchemes.primary.length] + '20',
                borderWidth: 3,
                pointRadius: 4,
                pointHoverRadius: 6,
                tension: 0.4
            }));
            
            charts.maintenance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Annual Maintenance Cost ($)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: $${context.parsed.y.toLocaleString()}`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Update recommendations
        function updateRecommendations() {
            const filtered = getFilteredData();
            
            // Best overall value (TCO vs credibility)
            const bestOverall = filtered.reduce((best, car) => {
                const carScore = car.founder_credibility_score / ((car.tco_3yr_low + car.tco_3yr_high) / 2) * 10000;
                const bestScore = best.founder_credibility_score / ((best.tco_3yr_low + best.tco_3yr_high) / 2) * 10000;
                return carScore > bestScore ? car : best;
            });
            document.getElementById('bestOverall').innerHTML = `
                <strong>${bestOverall.make} ${bestOverall.model}</strong><br>
                TCO: $${Math.round((bestOverall.tco_3yr_low + bestOverall.tco_3yr_high) / 2).toLocaleString()}<br>
                Credibility: ${bestOverall.founder_credibility_score}/10
            `;
            
            // Best reliability
            const bestReliability = filtered.reduce((best, car) => 
                car.reliability_score > best.reliability_score ? car : best
            );
            document.getElementById('bestImage').innerHTML = `
                <strong>${bestReliability.make} ${bestReliability.model}</strong><br>
                Reliability: ${bestReliability.reliability_score}/10<br>
                TCO: $${Math.round((bestReliability.tco_3yr_low + bestReliability.tco_3yr_high) / 2).toLocaleString()}
            `;
            
            // Best budget option
            const bestBudget = filtered.reduce((best, car) => {
                const avgTCO = (car.tco_3yr_low + car.tco_3yr_high) / 2;
                const bestAvgTCO = (best.tco_3yr_low + best.tco_3yr_high) / 2;
                return avgTCO < bestAvgTCO ? car : best;
            });
            document.getElementById('bestBudget').innerHTML = `
                <strong>${bestBudget.make} ${bestBudget.model}</strong><br>
                TCO: $${Math.round((bestBudget.tco_3yr_low + bestBudget.tco_3yr_high) / 2).toLocaleString()}<br>
                Credibility: ${bestBudget.founder_credibility_score}/10
            `;
            
            // Best cool factor (founder credibility)
            const bestCoolFactor = filtered.reduce((best, car) => 
                car.founder_credibility_score > best.founder_credibility_score ? car : best
            );
            document.getElementById('bestPerformance').innerHTML = `
                <strong>${bestCoolFactor.make} ${bestCoolFactor.model}</strong><br>
                Cool Factor: ${bestCoolFactor.founder_credibility_score}/10<br>
                Reliability: ${bestCoolFactor.reliability_score}/10<br>
                TCO: $${Math.round((bestCoolFactor.tco_3yr_low + bestCoolFactor.tco_3yr_high) / 2).toLocaleString()}
            `;
        }
        
        // Setup filter event listeners
        function setupFilters() {
            const credibilityFilter = document.getElementById('credibilityFilter');
            const credibilityValue = document.getElementById('credibilityValue');
            
            credibilityFilter.addEventListener('input', function() {
                credibilityValue.textContent = this.value;
                updateDashboard();
            });
            
            // Add event listeners for all filter controls
            document.getElementById('budgetFilter').addEventListener('change', updateDashboard);
            document.getElementById('brandFilter').addEventListener('change', updateDashboard);
            document.getElementById('categoryFilter').addEventListener('change', updateDashboard);
            document.getElementById('fuelFilter').addEventListener('change', updateDashboard);
            document.getElementById('reliabilityFilter').addEventListener('change', updateDashboard);
        }
        
        // Update dashboard with current filters
        function updateDashboard() {
            // Destroy existing charts
            Object.values(charts).forEach(chart => chart.destroy());
            charts = {};
            
            // Recreate with filtered data
            updateStats();
            createCharts();
            updateRecommendations();
        }
        
        // Show risk analysis modal
        function showRiskAnalysis(carName) {
            const riskData = carRisks[carName];
            if (!riskData) {
                alert(`No risk data available for ${carName}`);
                return;
            }
            
            const content = `
                <h2 style="color: #2c3e50; margin-bottom: 30px;">üîç Risk Analysis: ${carName}</h2>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                    <div>
                        <h3 style="color: #e74c3c; margin-bottom: 15px;">üö® Major Risks</h3>
                        <ul style="list-style: none; padding: 0;">
                            ${riskData.major_risks.map(risk => `<li style="margin-bottom: 10px; padding: 10px; background: #ffe6e6; border-left: 4px solid #e74c3c; border-radius: 5px;">${risk}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div>
                        <h3 style="color: #f39c12; margin-bottom: 15px;">‚ö†Ô∏è Medium Risks</h3>
                        <ul style="list-style: none; padding: 0;">
                            ${riskData.medium_risks.map(risk => `<li style="margin-bottom: 10px; padding: 10px; background: #fff3e0; border-left: 4px solid #f39c12; border-radius: 5px;">${risk}</li>`).join('')}
                        </ul>
                    </div>
                </div>
                
                <div style="margin-bottom: 30px;">
                    <h3 style="color: #27ae60; margin-bottom: 15px;">‚úÖ Why It's Still Good</h3>
                    <ul style="list-style: none; padding: 0;">
                        ${riskData.why_still_good.map(reason => `<li style="margin-bottom: 10px; padding: 10px; background: #e8f5e8; border-left: 4px solid #27ae60; border-radius: 5px;">${reason}</li>`).join('')}
                    </ul>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div style="padding: 20px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 10px;">
                        <h4 style="margin-bottom: 10px;">üí∞ Cost Analysis</h4>
                        <p style="margin: 0; font-size: 14px;">${riskData.actual_cost_analysis}</p>
                    </div>
                    
                    <div style="padding: 20px; background: linear-gradient(135deg, #11998e, #38ef7d); color: white; border-radius: 10px;">
                        <h4 style="margin-bottom: 10px;">üë§ Founder Perspective</h4>
                        <p style="margin: 0; font-size: 14px;">${riskData.founder_perspective}</p>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button onclick="closeRiskModal()" style="padding: 15px 30px; background: #667eea; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer;">Close Analysis</button>
                </div>
            `;
            
            document.getElementById('riskContent').innerHTML = content;
            document.getElementById('riskModal').style.display = 'block';
        }
        
        // Close risk modal
        function closeRiskModal() {
            document.getElementById('riskModal').style.display = 'none';
        }
        
        // Setup modal event listeners
        function setupModalListeners() {
            document.getElementById('closeModal').addEventListener('click', closeRiskModal);
            document.getElementById('riskModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeRiskModal();
                }
            });
        }
        
        // Live price scraping function
        async function scrapeLatestPrices() {
            const button = document.querySelector('.scrape-button');
            const originalText = button.innerHTML;
            button.innerHTML = '‚è≥ Scraping...';
            button.disabled = true;
            
            try {
                const PROXY = 'https://api.allorigins.win/raw?url=';
                const results = [];
                
                // Sample a few cars to scrape
                const sampleCars = carData.slice(0, 5);
                
                for (const car of sampleCars) {
                    try {
                        // Try multiple sources
                        const price = await scrapeCarPrice(car.make, car.model);
                        if (price) {
                            // Update car data with live price
                            car.live_price = price.avgPrice;
                            car.price_range_low = Math.min(price.minPrice, car.price_range_low);
                            car.price_range_high = Math.max(price.maxPrice, car.price_range_high);
                            car.last_updated = new Date().toISOString();
                            results.push(`${car.make} ${car.model}: $${price.avgPrice.toLocaleString()}`);
                        }
                        await new Promise(resolve => setTimeout(resolve, 1000)); // Rate limiting
                    } catch (error) {
                        console.error(`Error scraping ${car.make} ${car.model}:`, error);
                    }
                }
                
                if (results.length > 0) {
                    alert(`Updated prices:\\n${results.join('\\n')}`);
                    updateDashboard(); // Refresh charts with new data
                } else {
                    alert('Unable to fetch live prices due to CORS restrictions. Using estimated data.');
                }
                
            } catch (error) {
                console.error('Scraping error:', error);
                alert('Unable to scrape live data. Check console for details.');
            }
            
            button.innerHTML = originalText;
            button.disabled = false;
        }
        
        async function scrapeCarPrice(make, model) {
            // Simplified scraping - in production would use proper APIs
            try {
                // Try Cars.com search URL
                const searchUrl = `https://www.cars.com/shopping/${make.toLowerCase()}-${model.toLowerCase().replace(' ', '_')}/`;
                const response = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(searchUrl)}`);
                const html = await response.text();
                
                // Extract prices from HTML (basic regex)
                const priceMatches = html.match(/\\$([0-9]{2,3}),?([0-9]{3})/g);
                if (priceMatches && priceMatches.length > 0) {
                    const prices = priceMatches
                        .map(p => parseInt(p.replace(/[$,]/g, '')))
                        .filter(p => p > 5000 && p < 200000)
                        .slice(0, 20); // Take first 20 valid prices
                    
                    if (prices.length > 2) {
                        return {
                            avgPrice: Math.round(prices.reduce((sum, p) => sum + p, 0) / prices.length),
                            minPrice: Math.min(...prices),
                            maxPrice: Math.max(...prices)
                        };
                    }
                }
            } catch (error) {
                console.error('Price scraping failed:', error);
            }
            return null;
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initDashboard();
            setupModalListeners();
        });
    </script>
</body>
</html>