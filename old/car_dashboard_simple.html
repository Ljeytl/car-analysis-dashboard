<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Analysis Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .top-picks {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 2px solid #3498db;
        }
        
        .picks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .pick-card {
            border: 1px solid #bdc3c7;
            border-radius: 8px;
            padding: 15px;
            background: rgba(52, 152, 219, 0.05);
        }
        
        .pick-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .pick-car {
            font-size: 1.2em;
            color: #3498db;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .pick-details {
            font-size: 0.9em;
            color: #555;
            line-height: 1.4;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
        }
        
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .chart-title {
            text-align: center;
            font-size: 1.2em;
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        canvas {
            max-height: 400px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöó Car Analysis Dashboard</h1>
        <p style="text-align: center; color: #7f8c8d; margin-bottom: 30px;">Real Market Data from KBB & Edmunds</p>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">48</div>
                <div class="stat-label">Cars Analyzed</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">$19,400</div>
                <div class="stat-label">Average 3-Year TCO</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">7.4</div>
                <div class="stat-label">Average Reliability</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">32%</div>
                <div class="stat-label">Average Depreciation</div>
            </div>
        </div>

        <div class="top-picks">
            <h2 style="text-align: center; color: #2c3e50; margin-bottom: 20px;">üéØ Top Picks for Founding Engineers</h2>
            <div class="picks-grid">
                <div class="pick-card">
                    <div class="pick-title">üí∞ Best TCO</div>
                    <div class="pick-car">Honda Civic</div>
                    <div class="pick-details">
                        $16,400 average TCO<br>
                        9/10 reliability rating<br>
                        $14k - $28k price range<br>
                        <small>Excellent 31% depreciation</small>
                    </div>
                </div>
                
                <div class="pick-card">
                    <div class="pick-title">üîß Most Reliable</div>
                    <div class="pick-car">Toyota RAV4 Hybrid</div>
                    <div class="pick-details">
                        9/10 reliability rating<br>
                        $21,300 average TCO<br>
                        $24k - $37k price range<br>
                        <small>Best-in-class 12% depreciation</small>
                    </div>
                </div>
                
                <div class="pick-card">
                    <div class="pick-title">‚ö° Best EV Value</div>
                    <div class="pick-car">Chevrolet Bolt EV</div>
                    <div class="pick-details">
                        $7,325 average TCO<br>
                        6/10 reliability<br>
                        $13k - $21k price range<br>
                        <small>55% depreciation = massive value</small>
                    </div>
                </div>
                
                <div class="pick-card">
                    <div class="pick-title">üèÜ Founding Engineer Special</div>
                    <div class="pick-car">Tesla Model 3</div>
                    <div class="pick-details">
                        $11,325 average TCO<br>
                        8/10 reliability<br>
                        $18k - $33k price range<br>
                        <small>Tech credibility + great value</small>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="charts-grid">
            <div class="chart-container">
                <div class="chart-title">TCO vs Reliability</div>
                <canvas id="tcoChart"></canvas>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">Top 10 Best Values</div>
                <canvas id="valueChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        let carData = [];
        
        function parseCSVData(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',');
            const cars = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                const car = {};
                headers.forEach((header, index) => {
                    car[header.trim()] = values[index] ? values[index].trim().replace(/"/g, '') : '';
                });
                
                const fuelCostMap = {
                    'Gas': parseInt(car.annual_fuel_cost) || 1200,
                    'Hybrid': parseInt(car.annual_fuel_cost) || 800,
                    'Electric': parseInt(car.annual_fuel_cost) || 300,
                    'PHEV': parseInt(car.annual_fuel_cost) || 600
                };
                
                const dashboardCar = {
                    name: `${car.make} ${car.model}`,
                    price: Math.round((parseInt(car.price_range_low) + parseInt(car.price_range_high)) / 2),
                    depreciation: parseInt(car.depreciation_3yr_percent),
                    fuel: car.fuel_type,
                    reliability: parseInt(car.reliability_score) || 7,
                    fuelCost: fuelCostMap[car.fuel_type] || 1200,
                    maintenanceCost: parseInt(car.maintenance_annual) || 500,
                    insuranceCost: parseInt(car.insurance_annual) || 400
                };
                
                dashboardCar.tco = Math.round(
                    dashboardCar.price * (dashboardCar.depreciation / 100) + 
                    (dashboardCar.fuelCost + dashboardCar.maintenanceCost + dashboardCar.insuranceCost) * 3
                );
                
                cars.push(dashboardCar);
            }
            return cars;
        }
        
        async function loadCarData() {
            try {
                const response = await fetch('comprehensive_car_analysis.csv');
                if (!response.ok) throw new Error('Network response was not ok');
                const csvText = await response.text();
                carData = parseCSVData(csvText);
                updateStats();
                createCharts();
            } catch (error) {
                console.error('Error loading car data:', error);
                carData = [];
            }
        }
        
        function updateStats() {
            if (carData.length === 0) return;
            
            const avgTCO = Math.round(carData.reduce((sum, car) => sum + car.tco, 0) / carData.length);
            const avgReliability = (carData.reduce((sum, car) => sum + car.reliability, 0) / carData.length).toFixed(1);
            const avgDepreciation = Math.round(carData.reduce((sum, car) => sum + car.depreciation, 0) / carData.length);
            
            document.querySelector('.stat-card:nth-child(1) .stat-number').textContent = carData.length;
            document.querySelector('.stat-card:nth-child(2) .stat-number').textContent = '$' + (avgTCO / 1000).toFixed(0) + 'k';
            document.querySelector('.stat-card:nth-child(3) .stat-number').textContent = avgReliability;
            document.querySelector('.stat-card:nth-child(4) .stat-number').textContent = avgDepreciation + '%';
        }
        
        function createCharts() {
            if (carData.length === 0) return;
            
            createTCOChart();
            createValueChart();
        }
        
        function createTCOChart() {
            const ctx1 = document.getElementById('tcoChart').getContext('2d');
            new Chart(ctx1, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Cars',
                        data: carData.map(car => ({
                            x: car.reliability,
                            y: car.tco,
                            label: car.name,
                            backgroundColor: car.fuel === 'Electric' ? '#3498db' : 
                                           car.fuel === 'Hybrid' || car.fuel === 'PHEV' ? '#2ecc71' : '#e74c3c'
                        })),
                        backgroundColor: carData.map(car => 
                            car.fuel === 'Electric' ? '#3498db' : 
                            car.fuel === 'Hybrid' || car.fuel === 'PHEV' ? '#2ecc71' : '#e74c3c'
                        ),
                        pointRadius: 8,
                        pointHoverRadius: 10
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const car = carData[context.dataIndex];
                                    return `${car.name}: $${car.tco.toLocaleString()} TCO, ${car.reliability}/10 reliability`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Reliability Score (1-10)' },
                            min: 5, max: 10
                        },
                        y: {
                            title: { display: true, text: '3-Year TCO ($)' },
                            ticks: {
                                callback: function(value) {
                                    return '$' + (value / 1000).toFixed(0) + 'k';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function createValueChart() {
            const ctx2 = document.getElementById('valueChart').getContext('2d');
            const sortedByTCO = [...carData].sort((a, b) => a.tco - b.tco).slice(0, 10);
            
            new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: sortedByTCO.map(car => car.name),
                    datasets: [{
                        label: '3-Year TCO',
                        data: sortedByTCO.map(car => car.tco),
                        backgroundColor: '#3498db',
                        borderColor: '#2980b9',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const car = sortedByTCO[context.dataIndex];
                                    return `${car.name}: $${car.tco.toLocaleString()} TCO, ${car.reliability}/10 reliability`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            title: { display: true, text: '3-Year TCO ($)' },
                            ticks: {
                                callback: function(value) {
                                    return '$' + (value / 1000).toFixed(0) + 'k';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Load data when page loads
        document.addEventListener('DOMContentLoaded', loadCarData);
    </script>
</body>
</html>